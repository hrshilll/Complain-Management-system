{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .pdf-export-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .pdf-export-panel h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }
        .pdf-export-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 13px;
        }
        .form-group select,
        .form-group input {
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn-export {
            background-color: #dc3545;
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.3s;
        }
        .btn-export:hover {
            background-color: #c82333;
            color: white;
        }
        .filter-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .filter-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .filter-option input[type="radio"] {
            margin: 0;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="pdf-export-panel">
        <h3>ðŸ“„ Export Complaints to PDF</h3>
        <form method="get" action="{{ pdf_export_url }}" class="pdf-export-form" id="pdfExportForm">
            <div class="form-group">
                <label>Filter Type:</label>
                <div class="filter-options">
                    <div class="filter-option">
                        <input type="radio" name="filter" value="week" id="filter_week" checked>
                        <label for="filter_week" style="margin: 0; font-weight: normal;">Week</label>
                    </div>
                    <div class="filter-option">
                        <input type="radio" name="filter" value="month" id="filter_month">
                        <label for="filter_month" style="margin: 0; font-weight: normal;">Month</label>
                    </div>
                    <div class="filter-option">
                        <input type="radio" name="filter" value="custom" id="filter_custom">
                        <label for="filter_custom" style="margin: 0; font-weight: normal;">Custom</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group" id="weekGroup" style="display: none;">
                <label>Week Start Date:</label>
                <input type="date" name="week_start" id="week_start">
            </div>
            
            <div class="form-group" id="monthGroup" style="display: none;">
                <label>Year:</label>
                <select name="year" id="year">
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024" {% if current_year == 2024 %}selected{% endif %}>2024</option>
                    <option value="2025" {% if current_year == 2025 %}selected{% endif %}>2025</option>
                    <option value="2026">2026</option>
                </select>
            </div>
            
            <div class="form-group" id="monthSelectGroup" style="display: none;">
                <label>Month:</label>
                <select name="month" id="month">
                    <option value="1" {% if current_month == 1 %}selected{% endif %}>January</option>
                    <option value="2" {% if current_month == 2 %}selected{% endif %}>February</option>
                    <option value="3" {% if current_month == 3 %}selected{% endif %}>March</option>
                    <option value="4" {% if current_month == 4 %}selected{% endif %}>April</option>
                    <option value="5" {% if current_month == 5 %}selected{% endif %}>May</option>
                    <option value="6" {% if current_month == 6 %}selected{% endif %}>June</option>
                    <option value="7" {% if current_month == 7 %}selected{% endif %}>July</option>
                    <option value="8" {% if current_month == 8 %}selected{% endif %}>August</option>
                    <option value="9" {% if current_month == 9 %}selected{% endif %}>September</option>
                    <option value="10" {% if current_month == 10 %}selected{% endif %}>October</option>
                    <option value="11" {% if current_month == 11 %}selected{% endif %}>November</option>
                    <option value="12" {% if current_month == 12 %}selected{% endif %}>December</option>
                </select>
            </div>
            
            <div class="form-group" id="customGroup" style="display: none;">
                <label>Start Date:</label>
                <input type="date" name="start_date" id="start_date">
            </div>
            
            <div class="form-group" id="customEndGroup" style="display: none;">
                <label>End Date:</label>
                <input type="date" name="end_date" id="end_date">
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn-export">ðŸ“¥ Download PDF</button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const filterRadios = document.querySelectorAll('input[name="filter"]');
            const weekGroup = document.getElementById('weekGroup');
            const monthGroup = document.getElementById('monthGroup');
            const monthSelectGroup = document.getElementById('monthSelectGroup');
            const customGroup = document.getElementById('customGroup');
            const customEndGroup = document.getElementById('customEndGroup');
            
            // Set default week start to 7 days ago
            const weekStartInput = document.getElementById('week_start');
            const today = new Date();
            const weekAgo = new Date(today);
            weekAgo.setDate(today.getDate() - 7);
            weekStartInput.value = weekAgo.toISOString().split('T')[0];
            
            // Set default custom dates
            const startDateInput = document.getElementById('start_date');
            const endDateInput = document.getElementById('end_date');
            endDateInput.value = today.toISOString().split('T')[0];
            const monthAgo = new Date(today);
            monthAgo.setMonth(today.getMonth() - 1);
            startDateInput.value = monthAgo.toISOString().split('T')[0];
            
            function updateFormVisibility() {
                const selectedFilter = document.querySelector('input[name="filter"]:checked').value;
                
                // Hide all groups
                weekGroup.style.display = 'none';
                monthGroup.style.display = 'none';
                monthSelectGroup.style.display = 'none';
                customGroup.style.display = 'none';
                customEndGroup.style.display = 'none';
                
                // Show relevant groups
                if (selectedFilter === 'week') {
                    weekGroup.style.display = 'block';
                } else if (selectedFilter === 'month') {
                    monthGroup.style.display = 'block';
                    monthSelectGroup.style.display = 'block';
                } else if (selectedFilter === 'custom') {
                    customGroup.style.display = 'block';
                    customEndGroup.style.display = 'block';
                }
            }
            
            // Add event listeners
            filterRadios.forEach(radio => {
                radio.addEventListener('change', updateFormVisibility);
            });
            
            // Initial visibility update
            updateFormVisibility();
        });
    </script>

    {{ block.super }}
{% endblock %}
